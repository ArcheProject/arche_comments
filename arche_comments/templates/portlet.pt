<tal:main xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="arche_comments">
<div class="portlet">

<a tal:condition="not comments and can_toggle"
   href="${request.resource_url(context, '_add_comments')}"
   class="btn btn-success" i18n:translate="">
  Create comments section
</a>

<tal:has_comments condition="comments">
  <h2 tal:condition="comments.enabled or can_toggle">${comments.title}</h2>

  <p tal:condition="can_toggle">
    <a tal:condition="comments.enabled == True"
       href="${request.resource_url(comments, '_toggle_comments')}"
       class="btn btn-warning btn-sm" i18n:translate="">
      Disable comments
    </a>
    <a tal:condition="comments.enabled == False"
       href="${request.resource_url(comments, '_toggle_comments', query={'enable': 1})}"
       class="btn btn-success btn-sm" i18n:translate="">
      Enable comments
    </a>
  </p>

  <tal:no_comments condition="len(comments) == 0 and comments.enabled">
    <i i18n:translate="">No comments yet</i>
  </tal:no_comments>

  <div data-comments class="hidden">
    <div class="comment">
    <hr/>
      <div class="comment-container">
        <div class="comment-head">
          <span class="author-img"></span>
          <b class="author">Author</b>
          <span class="created text-muted small">Created</span>
        </div>
        <div class="comment-body">Body</div>
      </div>
    </div>
  </div>

  <div data-comment-form></div>
  <tal:add_comment tal:condition="can_add">
    <hr/>
    <a data-add-comment
       href="${request.resource_url(comments, 'add')}"
       class="btn btn-success btn-sm">
      <span data-actionmarker="glyphicon glyphicon-refresh rotate-me"></span>
      <span class="glyphicon glyphicon-comment"></span>
      <span i18n:translate="">Comment</span>
    </a>
  </tal:add_comment>

  <script tal:define="url request.resource_url(comments, 'comments.json')">
    $(function () {
        comments = new Comments("${url}");
        $('[data-add-comment]').on('click', comments.load_comment_form);
        comments.load_comments();
    });
  </script>

</tal:has_comments>

</div>
</tal:main>
